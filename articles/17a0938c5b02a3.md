---
title: "useEffectEventé–¢æ•°ã¯ã€useEffectã®ä¾å­˜é…åˆ—ã«å«ã‚ã¦ã¯ã„ã‘ãªã„"
emoji: "ðŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---

# ã¯ã˜ã‚ã«

ã“ã¡ã‚‰ã‚’è¨˜äº‹ã«ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

https://speakerdeck.com/maguroalternative/react19-dot-2nouseeffecteventwozhui-u

# React19.2ãŒãƒªãƒªãƒ¼ã‚¹

2025/10/1ã«React19.2ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚

https://react.dev/blog/2025/10/01/react-19-2

ä¸­ã§ã‚‚æ–°ã—ã„hooksã§ã‚ã‚‹`useEffectEvent`ãŒè¿½åŠ ã•ã‚Œã€ã€Œstale closureå•é¡Œã€ã«ãƒ¡ã‚¹ãŒå…¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

# stale closureå•é¡Œ

ç°¡å˜ã«è¨€ãˆã°ã€ã€Œå¤ã„çŠ¶æ…‹ã‚’å‚ç…§ã—ç¶šã‘ã‚‹ã€ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚
ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚

```tsx
export function Example() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log("add listener")
    const handler = () => {
      console.log(count); // â† ã“ã“ãŒã€Œå¤ã„å€¤ã€ã«ãªã‚‹
    };
    window.addEventListener('click', handler);
    return () => window.removeEventListener('click', handler);
  }, []);
  
  return <button onClick={() => setCount(c => c + 1)}>+1</button>;
}
```

å†…å®¹ã¨ã—ã¦ã¯ã€Œã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã‚‹ãŸã³ã«countã‚’consoleã«è¡¨ç¤ºã™ã‚‹ã€ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚
buttonã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨countãŒã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã•ã‚Œã¾ã™ã€‚
ä¸€è¦‹ã€ä½•ã‚‰å•é¡Œãªã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’è¦—ãã¨ã€ã€ã€



ã¯ã„ã€‚countãŒ0ã®ã¾ã¾ã§ã™ã€‚
ã“ã‚Œã¯useEffectå†…ã§ã®countãŒã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ç™»éŒ²æ™‚ã®ã‚‚ã®ã‚’å‚ç…§ã—ç¶šã‘ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚
ã“ã®çŠ¶æ…‹ã‚’ã€Œstale closureå•é¡Œã€ã¨è¨€ã„ã¾ã™ã€‚

ä¸€å¿œã®è§£æ±ºç­–ã¨ã—ã¦ã¯ã€useEffectã®ä¾å­˜é…åˆ—ã«countã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãªã®ã§ã™ãŒã€ã“ã‚Œã¯ã“ã‚Œã§åˆ¥ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

```tsx
export function Example() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log("add listener")
    const handler = () => {
      console.log(count); // â† ã“ã“ãŒã€Œå¤ã„å€¤ã€ã«ãªã‚‹
    };
    window.addEventListener('click', handler);
    return () => window.removeEventListener('click', handler);
  }, [count]);
  
  return <button onClick={() => setCount(c => c + 1)}>+1</button>;
}
```

ã“ã‚Œã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è¦—ãã¨


countã¯æ›´æ–°ã§ãã¾ã—ãŸãŒã€æ–°ãŸã«ã€Œadd listenerã€ã®è¡¨ç¤ºãŒæ¯Žå›žã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ã“ã‚Œã¯countãŒæ›´æ–°ã•ã‚Œã‚‹ãŸã³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ä¸­èº«ã®countã¯ãã®åº¦ã«æœ€æ–°ã®ã‚‚ã®ã«ãªã‚Šã¾ã™ãŒã€ã‚ã–ã‚ã–ãã®ãŸã‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å†ç™»éŒ²ã™ã‚‹ã®ã¯ä½™åˆ†ã§ã™ã€‚

æœ€æ–°ã®countã‚’å‚ç…§ã•ã›ãŸã„ãŒã€ã„ã¡ã„ã¡ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’å†ç™»éŒ²ã•ã›ãŸããªã„ã€ã€ã€ãã‚“ãªæ™‚ã«ã“ã`useEffectEvent`ã®å‡ºç•ªã§ã™ã€‚

```tsx
export function Example() {
  const [count, setCount] = useState(0);

  const handlerClick = useEffectEvent(() => {
    console.log(count);
  })

  useEffect(() => {
    console.log("add listener")
    window.addEventListener('click', handlerClick);
    return () => window.removeEventListener('click', handlerClick);
  }, []);
  
  return <button onClick={() => setCount(c => c + 1)}>+1</button>;
}
```
